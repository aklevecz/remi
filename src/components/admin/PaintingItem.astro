---
import { Image } from "astro:assets";

const env = process.env.NODE_ENV;
// const imgHost = env === "production" ? "https://storage.remifrogo.art" : "http://localhost:4321/img";
const imgHost =  "https://storage.remifrogo.art"

const { key, rank } = Astro.props;
const R2 = Astro.locals.runtime.env.R2;
let painting: any = null;
if (process.env.NODE_ENV === "production") {
  painting = await R2.get(key);
} else {
  painting = await fetch("http://localhost:8787/remi/" + encodeURIComponent(key)).then((res) => res.json());
}
const metaData = painting.customMetadata;
---

<div id={key} draggable="true">
  <div class="painting-view">
    <Image
      width="300"
      height="300"
      src={`${imgHost}/${key}`}
      alt={key}
    />
    <!-- <div>
      <h1>{metaData.title}</h1>
      <h2>{key}</h2>
      <p>{metaData.material}</p>
      <p>{metaData.dimensions}</p>
      <p>{metaData.year}</p>
    </div> -->

    <a href={`/admin?action=del&key=${key}`}>DELETE</a>
    <button id="edit-button">EDIT</button>
  </div>
  <form method="POST" class="hidden" enctype="multipart/form-data">
    <input type="hidden" name="type" value="painting" />
    <input type="hidden" name="key" value={key} />
    <input type="text" name="title" value={metaData.title} />
    <input type="text" name="material" value={metaData.material} />
    <input type="text" name="dimensions" value={metaData.dimensions} />
    <input type="text" name="year" value={metaData.year} />
    <input type="text" name="rank" value={metaData?.rank} />
    <input type="file" name="image" accept="image/*" />
    <button type="submit">Save</button>
  </form>
</div>
<script define:vars={{ key }}>
  const container = document.getElementById(`${key}`);
  container.querySelector("#edit-button").addEventListener("click", () => {
    container.querySelector("form").classList.toggle("hidden");
  });
  // const draggableElement = container.querySelector('[draggable="true"]')
  // draggableElement.addEventListener('dragstart', (event) => {
  //   event.dataTransfer.setData('text/plain', event.target.id);
  // });
</script>
<style>
  .painting-view {
    display: flex;
    flex-direction: column;
  }
  a {
    box-sizing: border-box;
    background-color: red;
    color: white;
    font-size: 1.25rem;
  }
  .hidden {
    display: none;
  }
  form {
    width: 300px;
  }
</style>
